
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Verifica Premio</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    #status {
      margin: 20px;
      font-size: 20px;
    }
    #prize {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .used {
      color: red;
      font-weight: bold;
    }
    .valid {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>üéüÔ∏è Verifica Premio</h1>
  <div id="status">Caricamento...</div>
  <div id="prize"></div>
  <button id="useBtn" style="display:none;">‚úÖ Segna come usato</button>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const apiBase = "https://district-pub-backend.onrender.com/api";

    const statusDiv = document.getElementById("status");
    const prizeDiv = document.getElementById("prize");
    const useBtn = document.getElementById("useBtn");

    if (!id) {
      statusDiv.textContent = "‚ùå QR non valido.";
    } else {
      fetch(`${apiBase}/claim/${id}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            statusDiv.innerHTML = "‚ùå QR non trovato.";
          } else if (data.used) {
            statusDiv.innerHTML = "<span class='used'>‚ö†Ô∏è Premio gi√† usato</span>";
            prizeDiv.textContent = data.prize;
          } else {
            statusDiv.innerHTML = "<span class='valid'>‚úÖ Premio valido!</span>";
            prizeDiv.textContent = data.prize;
            useBtn.style.display = "inline-block";

            useBtn.addEventListener("click", () => {
              fetch(`${apiBase}/use-claim`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id })
              }).then(() => {
                statusDiv.innerHTML = "<span class='used'>‚úÖ Premio segnato come usato</span>";
                useBtn.style.display = "none";
              });
            });
          }
        })
        .catch(() => {
          statusDiv.textContent = "‚ùå Errore di connessione al server.";
        });
    }
  </script>
</body>
</html>
